<html>
<head>
    <title>发送账单</title>
    <link type="text/css" rel="stylesheet" href="/safecampus/campus/payment/pay.css">
    <link type="text/css" rel="stylesheet" href="/safecampus/campus/payment/send.css">
    <script type="text/javascript" src="/cyan/client/validate.js"></script>
    <script type="text/javascript" src="/platform/commons/crud.js"></script>
</head>
<body>

<div class="box">

    <div class="box_bt">
        <h2>账单详情</h2>
    </div>
    <div class="zdjj2">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="zdlb">
            <tr>
                <td class="td1"><span>账单编号：</span>${payItem.serialNo}</td>
                <td colspan="2"><span>账单名称：</span>${payItem.payItemName}</td>
            </tr>
            <tr>
                <td><span>缴费类型：</span>${payItem.paymentType}</td>
                <td><span>缴费金额：</span>${payItem.money}元</td>
            </tr>
            <tr>
                <td><span>截止日期：</span>${payItem.deadline}</td>
                <td><span>创建日期：</span>${payItem.creatTime}</td>
            </tr>
            <tr>
                <td colspan="3"><span>账单详情：</span>${payItem.desc}</td>
            </tr>
        </table>
    </div>


    <div id="selectSession" class="zdjj">
        <div class="fssz">
            <p class="p1">发送设置：</p>

        </div>

        <div class="chooseMsg">

            <input type="checkbox" id="sendAll"/>
            <label for="sendAll"> 全选</label>

            <span id="chooseCount" class="chooseCount">
					<span>已选择 </span>
            <strong id="recent">0</strong>
             <strong>/</strong>
             <strong id="total">0</strong>
            <span>人</span>
				</span>
        </div>

        <div id="selectTuition" class="select">

            <div class="session" id="grades" data-type="grade">
                <div class="block"><span>年级</span></div>
                <ul></ul>
            </div>
            <div class="session" id="classes">
                <div class="block"><span>班级</span></div>
            </div>

            <div class="session stuList" id="students">
                <div class="block stuAutoHide">学生</div>
            </div>
        </div>

        <div id="selectHost" class="select">
            <div class="session" id="hostRoom">
                <div class="block"><span>托管室</span></div>
                <ul></ul>
            </div>
            <div class="session stuList" id="hostStudents">
                <div class="block stuAutoHide">学生</div>
            </div>

        </div>

        <div id="selectSchoolBus" class="select">

            <div class="session" id="bus">
                <div class="block"><span>校巴</span></div>
                <ul></ul>
            </div>

            <div class="session stuList" id="busStudents">
                <div class="block stuAutoHide">学生</div>
            </div>

        </div>
    </div>
    <div class="">
        <div class="fs">
            <button id="subSend" type="button">发送账单</button>
            <button class="btn2" id="subBack">返回</button>
        </div>
    </div>


</div>
<script type="text/javascript" src="/safecampus/js/jquery.js"></script>
<script type="text/javascript" src="/safecampus/campus/payment/pay.js"></script>

<script>


    if ("${payItem.paymentType}" == "托管费") {
        //展示全部学生，对已发送账单的学生进行标识，可选性设为： 不可选
        showHost("${payItem.payItemId}", 0);
    } else if ("${payItem.paymentType}" == "校巴费") {
        //展示全部学生，对已发送账单的学生进行标识，可选性设为： 不可选
        showBus("${payItem.payItemId}", 0);
    } else {
        // if ("${payItem.paymentType}" == "学费"||"${payItem.paymentType}" == "其它") {
        //展示全部学生，对已发送账单的学生进行标识，可选性设为： 不可选
        showTuition("${payItem.payItemId}", 0);

    }


    $("button#subBack").click(function () {
        System.closePage();
    });

    $("button#subSend").click(function () {

        send("${payItem.payItemId}", function (n) {
            Cyan.message("已发送：" + n + " 个账单", function () {
                System.closePage();
            });
        })
    });

    function send(payItemId, callback) {

        var arr = [];
        $(".select").find(".stuList").find(".checkAll").each(function () {
            if ($(this).attr("disabled") != "disabled")
                arr.push($(this).val());
        });

        if (arr.length == 0) {
            Cyan.message("学生数量不能为 0")
        } else {

            console.log("students=" + arr.join("&students="));

            $.post(
                "/campus/pay/payItem/sendPostTo/" + payItemId,
                {
                    "studentArray": arr.join("-")
                },
                function (result) {
                    if (callback) {
                        callback(result);
                    }
                }
            )
                .error(function () {
                    //fireFox may post error
                    $.get(
                        "/campus/pay/payItem/sendTo/" + payItemId + "?studentArray=" + arr.join("-"),
                        function (result) {
                            if (callback) {
                                callback(result);
                            }
                        }
                    )
                })
        }
    }

</script>

</body>
</html>

<script>

</script>
